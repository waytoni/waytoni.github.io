<!DOCTYPE html>
<html lang="en">
<head>
	<!-- Google tag (gtag.js) -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-B9ZTNLS3FQ"></script>
	<script>
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());

	gtag('config', 'G-B9ZTNLS3FQ');
	</script>
    	<link rel="icon" type="image/x-icon" href="/favicon.ico">
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
	<link rel="manifest" href="/site.webmanifest">   

	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	

	<link rel="stylesheet" type="text/css" href="/css/nav_menu.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

	<script src="/scripts/nav_function.js"></script>
	<script src="/scripts/templates/load-template.js"></script>
	
	<style>
	h1, h2, h3, p, a {
		text-align: center;
	}
	</style>

   	<style>
		body {
			font-family: Arial, sans-serif;
		}

		#video-container {
			margin-top: 20px;
		}

		#notes {
			margin-top: 20px;
			white-space: pre-wrap;
		}

		#controls {
			margin-top: 20px;
		}

	</style>
	<title>ධර්ම සාකච්ඡා</title>
</head>
<body>

    <div class="topnav" id="Topnavbar">
        <!-- Content will be loaded here automatically by load-template.js-->
    </div>

	<h1>කෙටි ධර්ම සාකච්ඡා</h1>
	<h2>කල්‍යාණ මිත්‍ර අජන්ත සම්පත් ගුරුතුමන් ගේ ධර්ම සාකච්ඡා</h2>

	<p></p>



	<p><label for="link-selector">Select a video from the dropdown menu:</label></p>
	<p><select id="link-selector" onchange="updateContent()">
		<!-- Options will be populated dynamically -->
	</select></p>
	<div id="controls">
		<center>

		<button onclick="navigate(-1)">Previous</button>
		<button onclick="navigate(1)">Next</button>
	</center>
	</div>
	<div id="video-container">
		<!-- YouTube video will be embedded here -->
	</div>
	<div id="notes">
		<!-- Notes will be displayed here -->
	</div>

	<script>
		let data;
		let seriesTitle = "කෙටි ධර්ම සාකච්ඡා"; // Changeable series title
		// Fetch the JSON data and populate the dropdown menu
		fetch('ShortDhammaDiscussions.json').then(response => {
			if (!response.ok) {
				throw new Error('Network response was not ok ' + response.statusText);
			}
			return response.json();
		}).then(json => {
			data = json;
			populateDropdown();
			displayLastEntry();
		}).catch(error => {
			console.error('There has been a problem with your fetch operation:', error);
		});
		// Function to populate the dropdown menu
		function populateDropdown() {
			const selector = document.getElementById('link-selector');
			data.forEach(item => {
				const option = document.createElement('option');
				option.value = item.url;
				option.text = item.comment ? `${item.index} ●  ${item.comment} ● ${item.date}` :
					`${item.index} ●  ${seriesTitle} ● ${item.date}`;
				option.dataset.index = item.index;
				selector.appendChild(option);
			});
		}
		// Function to update the YouTube video and notes based on the selected option
		function updateContent() {
			const selector = document.getElementById('link-selector');
			const selectedOption = selector.options[selector.selectedIndex];
			const url = selectedOption.value;
			const index = selectedOption.dataset.index;
			const notes = data.find(item => item.index == index).notes;
			const videoContainer = document.getElementById('video-container');
			videoContainer.innerHTML =
				`<p><iframe width="560" height="315" src="${url.replace('watch?v=', 'embed/')}" frameborder="0" allowfullscreen></iframe></p>`;
			const notesContainer = document.getElementById('notes');
			
			notesContainer.innerHTML = '<p>'+ notes + '</p>'; // Use innerHTML to render clickable links
			
		}
		// Function to display the last entry from the JSON data on the initial load
		function displayLastEntry() {
			if (data.length > 0) {
				const lastEntry = data[data.length - 1];
				const selector = document.getElementById('link-selector');
				selector.value = lastEntry.url;
				updateContent();
			}
		}
		// Function to navigate to the previous or next video
		function navigate(direction) {
			const selector = document.getElementById('link-selector');
			let newIndex = selector.selectedIndex + direction;
			if (newIndex < 0) {
				newIndex = selector.options.length - 1;
			} else if (newIndex >= selector.options.length) {
				newIndex = 0;
			}
			selector.selectedIndex = newIndex;
			updateContent();
		}
	</script>
</body>
</html>